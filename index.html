<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Untuk Kamu â€” Spesial Ulang Tahun ğŸ‚</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<style>
  :root{
    --accent:#ffcce0;
    --muted:#a4b8cc;
    --text:#f6f9ff;
    --bg:#060616;
  }
  html,body{
    height:100%;margin:0;overflow:hidden;
    font-family:'Inter',sans-serif;
    background:linear-gradient(180deg,#050517 0%,#0c132b 65%);
    color:var(--text);
    display:flex;align-items:center;justify-content:center;
  }

  .introWrap{text-align:center;}
  #countNum{font-size:100px;font-weight:900;color:var(--accent);margin:0;}
  #countText{font-size:18px;color:var(--muted);margin-top:10px;}

  #videoSection{
    display:none;
    position:fixed;inset:0;
    background:rgba(0,0,0,0.85);
    justify-content:center;align-items:center;
  }
  .videoContainer{
    width:90%;
    max-width:600px;
    aspect-ratio:16/9;
    overflow:hidden;
    border-radius:20px;
    box-shadow:0 0 25px rgba(255,200,220,0.4);
  }
  #introVideo{
    width:100%;height:100%;object-fit:cover;
    display:block;border-radius:20px;
  }

  .finalwrap{
    display:none;
    position:fixed;inset:0;
    justify-content:center;align-items:center;
    background:linear-gradient(180deg,rgba(0,0,0,0.7),rgba(0,0,0,0.9));
    text-align:center;
  }
  .finalCard h2{color:var(--accent);font-size:30px;margin:0;}
  .finalCard p{color:var(--muted);font-size:16px;margin-top:10px;}
</style>
</head>
<body>

<!-- COUNTDOWN -->
<!-- GIFT OPENING -->
<div id="giftScreen" style="
  position:fixed; inset:0; background:#0d0d1c;
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  color:white; z-index:9999; text-align:center;">
  
  <h2 style="margin-bottom:20px; color:#ffcce0;">Ada hadiah buat kamu ğŸ</h2>
  
  <div id="giftBox" style="
    width:150px; height:150px; background:#ff99c8;
    border-radius:20px; display:flex; align-items:center; justify-content:center;
    font-size:40px; cursor:pointer;">
    ğŸ
  </div>

  <p style="margin-top:15px; color:#a4b8cc;">Klik dulu kadonya yaâ€¦</p>
</div>

<!-- POLKADOT / CONFETTI -->
<canvas id="confettiCanvas" style="
  position:fixed; inset:0; pointer-events:none; display:none; z-index:9000;">
</canvas>
<!-- MINI GAME -->
<div id="miniGameScreen" style="
  position:fixed; inset:0; background:#0b0f22;
  display:none; flex-direction:column; align-items:center; justify-content:center;
  text-align:center; color:white; z-index:9998;">

  <h2 style="color:#ffcce0; margin-bottom:10px;">Mini Game Dulu ğŸ˜</h2>
  <p style="color:#a4b8cc;">Klik 10 hati sebelum mereka kabur!</p>

  <div id="heartsArea" style="position:relative; width:100%; height:70%; overflow:hidden;">
  </div>

  <p id="heartCounter">0 / 10</p>
</div>

<!-- VIDEO -->
<div id="videoSection">
  <div class="videoContainer">
   <video id="introVideo" playsinline preload="auto">
      <source src="intro.mp4" type="video/mp4" />
    </video>
  </div>
</div>
<div id="loadingOverlay" style="
  display:none;
  position:fixed;inset:0;
  background:black;
  color:white;
  flex-direction:column;
  align-items:center;
  justify-content:center;
  font-family:'Inter',sans-serif;
  z-index:9999;">
  <div id="loadingText" style="margin-bottom:15px;">Loading sabar yang...</div>
  <div style="width:70%;height:10px;background:#222;border-radius:5px;overflow:hidden;">
    <div id="progressBar" style="width:0%;height:100%;background:#ffb3d9;transition:width 0.2s;"></div>
  </div>
</div>
 
<!-- FINAL SLIDES -->
  <div id="bookEnding" style="
  position:fixed; inset:0; background:#ffdde4;
  display:none; align-items:center; justify-content:center; overflow:hidden;
  z-index:9998;">

  <!-- hearts floating -->
  <div id="floatingHearts"></div>

  <!-- book -->
  <div id="bookPage" style="
    width:80%; max-width:600px; height:70%;
    background:white; border-radius:10px;
    transform-origin:left center; transform:rotateY(90deg);
    box-shadow:0 15px 30px rgba(0,0,0,.2);
    padding:30px; text-align:center;">

    <h2 style="color:#ff66a3;">Happy Birthday Devit aka little_drax7 ğŸ‰</h2>
    <p style="color:#555;">
      makasih udah jadi partner balapan roblox, partner naik gunung, dan partner nyebelin harian :))
    </p>
  </div>
</div>

  
<div id="finalWrap2" class="finalwrap">
  <div class="finalCard">
    <h2>Kurang-kurangin tuh begadangnya. ğŸ¥¹</h2>
    <p>jaga kesehatan ya. jangan sampai sakit ultramen penjaga buminya </p>
  </div>
</div>

<div id="finalWrap3" class="finalwrap">
  <div class="finalCard">
    <h2>Tetap jadi kamu</h2>
    <p>yang kadang ngeselin, nyebelin tapi ada sisi manisnya ğŸ’« (hueekk kok mual ya)</p>
  </div>
</div>

<div id="finalWrap4" class="finalwrap">
  <div class="finalCard">
    <h2>Doaku buat yg lagi hbd ğŸ¤</h2>
    <p>semoga semua langkahmu dipermudah, rezekimu dilancarkan, dan hatimu selalu tenang</p>
  </div>
</div>

<div id="finalWrap5" class="finalwrap">
  <div class="finalCard">
    <h2>love u ğŸ’•</h2>
    <p>geliiii sumpah</p>
  </div>
</div>
  
<!-- AUDIO COUNTDOWN -->
<audio id="countAudio" preload="auto">
  <source src="song.mp3" type="audio/mpeg">
</audio>

<script>const introWrap = document.getElementById('introWrap');
const countNum = document.getElementById('countNum');
const videoSection = document.getElementById('videoSection');
const introVideo = document.getElementById('introVideo');
const countAudio = document.getElementById('countAudio');
const loadingOverlay = document.getElementById('loadingOverlay');
const progressBar = document.getElementById('progressBar');
const loadingText = document.getElementById('loadingText');

const finalSlides = [
  document.getElementById('finalWrap'),
  document.getElementById('finalWrap2'),
  document.getElementById('finalWrap3'),
  document.getElementById('finalWrap4'),
  document.getElementById('finalWrap5')
];

document.body.addEventListener('click', startCountdown, { once:true });

function startCountdown(){
  runCountdown();
}

function runCountdown(){
  let remaining = 3;
  countNum.textContent = remaining;
  const tick = setInterval(()=>{
    remaining--;
    if(remaining >= 0){
      gsap.fromTo(countNum,{scale:1.2,opacity:0.3},{scale:1,duration:0.6,opacity:1,ease:'power2.out'});
      countNum.textContent = remaining;
    }
    if(remaining <= 0){
      clearInterval(tick);
      startVideo();
    }
  },1000);
}

function startVideo(){
  gsap.to(introWrap,{opacity:0,duration:0.8,onComplete:()=>{
    introWrap.style.display='none';
    videoSection.style.display='flex';
    gsap.fromTo(videoSection,{opacity:0},{opacity:1,duration:1});
    showLoading();

    introVideo.load();
    introVideo.addEventListener('canplaythrough', () => {
      hideLoading();
      introVideo.play().catch(e=>console.warn(e));
    }, { once:true });
  }});
}

// âœ… Progress bar update
introVideo.addEventListener('progress', ()=>{
  if (introVideo.buffered.length > 0 && introVideo.duration > 0) {
    const bufferedEnd = introVideo.buffered.end(introVideo.buffered.length - 1);
    const percent = (bufferedEnd / introVideo.duration) * 100;
    progressBar.style.width = percent + '%';
    loadingText.textContent = `Loading video... ${Math.round(percent)}%`;
  }
});

introVideo.addEventListener('waiting', showLoading);
introVideo.addEventListener('playing', hideLoading);

introVideo.addEventListener('ended', ()=>{
  gsap.to(videoSection,{opacity:0,duration:1,onComplete:()=>{
    videoSection.style.display='none';
    countAudio.currentTime = 0;
    countAudio.play().catch(e => console.warn(e));
    playFinalSlides(0);
  }});
});

function showLoading(){
  loadingOverlay.style.display = 'flex';
  progressBar.style.width = '0%';
  loadingText.textContent = 'Loading video...';
}

function hideLoading(){
  loadingOverlay.style.display = 'none';
}

function playFinalSlides(index){
  if(index >= finalSlides.length) return;
  const slide = finalSlides[index];
  slide.style.display='flex';
  gsap.fromTo(slide,{opacity:0},{opacity:1,duration:1});
  setTimeout(()=>{
    gsap.to(slide,{opacity:0,duration:1,onComplete:()=>{
      slide.style.display='none';
      playFinalSlides(index+1);
    }});
  },6000);
}
// ============= GIFT OPENING =============
const giftScreen = document.getElementById('giftScreen');
const giftBox = document.getElementById('giftBox');
const confettiCanvas = document.getElementById('confettiCanvas');
const ctx = confettiCanvas.getContext('2d');

giftBox.addEventListener('click', ()=>{
  confettiCanvas.style.display = 'block';
  startConfetti();

  gsap.to(giftScreen, {opacity:0, duration:1, onComplete:()=>{
    giftScreen.style.display = 'none';
    startCountdown(); // PANGGIL COUNTDOWN ASLI KAMU
  }});
});

// ============= CONFETTI POLKADOT =============
let confettis = [];
function startConfetti(){
  confettiCanvas.width = innerWidth;
  confettiCanvas.height = innerHeight;

  for(let i=0;i<70;i++){
    confettis.push({
      x: Math.random()*innerWidth,
      y: Math.random()*innerHeight - innerHeight,
      r: Math.random()*8 + 4,
      color: ['#ff99c8','#ffcce0','#ffb3d9','#ffe5ec'][Math.floor(Math.random()*4)],
      speed: Math.random()*3 + 1
    });
  }
  animateConfetti();
}

function animateConfetti(){
  ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
  confettis.forEach(c=>{
    ctx.beginPath();
    ctx.arc(c.x, c.y, c.r, 0, Math.PI*2);
    ctx.fillStyle=c.color;
    ctx.fill();
    c.y+=c.speed;
    if(c.y > innerHeight+20) c.y = -20;
  });
  requestAnimationFrame(animateConfetti);
}

// ============= MINI GAME HATI =============
const miniGameScreen = document.getElementById('miniGameScreen');
const heartsArea = document.getElementById('heartsArea');
const heartCounter = document.getElementById('heartCounter');

let hit = 0;

function startMiniGame(){
  miniGameScreen.style.display = 'flex';
  spawnHeart();
}

function spawnHeart(){
  for(let i=0;i<10;i++){
    const h = document.createElement('div');
    h.innerHTML = 'â¤ï¸';
    h.style.position = 'absolute';
    h.style.left = Math.random()*80 + '%';
    h.style.top = Math.random()*80 + '%';
    h.style.fontSize = '30px';
    h.style.cursor = 'pointer';

    h.addEventListener('click', ()=>{
      hit++;
      heartCounter.textContent = hit + ' / 10';
      h.remove();
      if(hit >= 10){
        endMiniGame();
      }
    });

    heartsArea.appendChild(h);

    // hearts slowly move
    gsap.to(h, {
      x: (Math.random()*100)-50,
      y: (Math.random()*100)-50,
      duration: 2,
      repeat: -1,
      yoyo: true
    });
  }
}

function endMiniGame(){
  gsap.to(miniGameScreen, {opacity:0, duration:1, onComplete:()=>{
    miniGameScreen.style.display='none';
    // lanjut ke VIDEO
    startVideo(); 
  }});
}

// Integrasi: Setelah countdown selesai â†’ JANGAN startVideo() langsung
// Tapi ganti:
// startMiniGame()

// ============= ENDING BOOK PAGE =============
const bookEnding = document.getElementById('bookEnding');
const bookPage = document.getElementById('bookPage');
const floatingHearts = document.getElementById('floatingHearts');

function showBookEnding(){
  bookEnding.style.display = 'flex';

  // buka halaman buku
  gsap.to(bookPage, {
    rotateY:0,
    duration:1.2,
    ease:"power3.out"
  });

  // floating hearts
  spawnFloatingHearts();
}

function spawnFloatingHearts(){
  setInterval(()=>{
    const h = document.createElement('div');
    h.innerHTML = 'ğŸ’—';
    h.style.position='absolute';
    h.style.left = Math.random()*100 + '%';
    h.style.bottom = '0';
    h.style.fontSize='20px';
    h.style.opacity = 0.8;

    floatingHearts.appendChild(h);

    gsap.to(h,{
      y:-300,
      opacity:0,
      duration:3,
      onComplete:()=>h.remove()
    });
  },300);
}

// Integrasi: setelah SLIDE terakhir â†’ panggil:
// showBookEnding();

</script>
</body>
</html>
