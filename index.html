<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Untuk Kamu â€” Spesial Ulang Tahun ğŸ‚</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
<style>
  :root{
    --accent:#ffcce0;
    --muted:#9fb6c9;
    --text:#0b1220;
    --bg:#060616;
  }
  html,body{
    height:100%;margin:0;overflow:hidden;
    font-family:Inter,system-ui,-apple-system,'Segoe UI',Roboto,Arial;
    background:linear-gradient(180deg,#050517 0%,#0c132b 65%);
    color:var(--text);
    display:flex;align-items:center;justify-content:center;
  }

  /* GIFT */
  #giftScreen{position:fixed; inset:0; background:#0d0d1c; display:flex; flex-direction:column; align-items:center; justify-content:center; color:white; z-index:9999; text-align:center;}
  #giftBox{width:160px; height:160px; border-radius:20px; display:flex; align-items:center; justify-content:center; font-size:44px; cursor:pointer; box-shadow:0 10px 40px rgba(0,0,0,0.5); transform-origin:center center;}

  /* CONFETTI CANVAS */
  #confettiCanvas{position:fixed; inset:0; pointer-events:none; display:none; z-index:9000;}

  /* COUNTDOWN */
  .introWrap{text-align:center; display:none; z-index:9980;}
  #countNum{font-size:92px;font-weight:900;color:var(--accent);margin:0;}
  #countText{font-size:16px;color:#a4b8cc;margin-top:8px;}

  /* MINI GAME */
  #miniGameScreen{position:fixed; inset:0; background:linear-gradient(180deg,#071029,#061227); display:none; flex-direction:column; align-items:center; justify-content:center; text-align:center; color:white; z-index:9998;}
  #heartsArea{position:relative; width:100%; height:70%; overflow:hidden; max-width:920px;}

  /* VIDEO */
  #videoSection{display:none; position:fixed;inset:0; background:rgba(0,0,0,0.92); justify-content:center;align-items:center; z-index:10020;}
  .videoContainer{width:92%; max-width:1100px; aspect-ratio:16/9; overflow:hidden; border-radius:14px; box-shadow:0 0 50px rgba(0,0,0,0.6);}
  #introVideo{width:100%;height:100%;object-fit:cover; display:block; border-radius:10px;}

  /* cinematic letterbox bars */
  .letterbar{position:fixed; left:0; right:0; height:0; background:black; z-index:10030; pointer-events:none;}
  #barTop{top:0;}
  #barBottom{bottom:0;}

  /* BOOK READER */
  #bookReader{position:fixed; inset:0; background:linear-gradient(180deg,#fff1f6,#ffeef8); display:none; justify-content:center; align-items:center; overflow:hidden; z-index:10010;}
  #bookWrapper{width:86%; max-width:1000px; height:74%; perspective:1600px; position:relative; transform:translateY(-2%);}
  #bookOuter{position:relative; width:100%; height:100%; transform:rotateZ(-6deg) translateX(2%);} /* tilt whole book right */
  #bookPages{position:absolute; inset:0; transform-style:preserve-3d;}
  .page{
    position:absolute;
    inset:0;
    margin:auto;
    width:92%;
    height:88%;
    background:white;
    border-radius:12px;
    box-shadow:0 20px 50px rgba(7,10,18,0.25);
    padding:36px;
    text-align:left;
    backface-visibility:hidden;
    transform-origin:left center;
    transform:rotateY(90deg) translateZ(0);
    display:flex;
    flex-direction:column;
    justify-content:center;
    overflow:hidden;
  }
  .page .page-title{font-size:28px;color:#ff4f9a;margin-bottom:8px; transform:rotate(-4deg);}
  .page .page-body{font-size:16px;color:#333; line-height:1.5; transform:rotate(-4deg);}
  .page { z-index:1; }

  /* hearts inside book */
  #bookHearts{position:absolute; inset:0; pointer-events:none; z-index:2;}

  /* Floating captions */
  .caption{
    position:fixed;
    left:50%;
    transform:translateX(-50%);
    top:12%;
    background:rgba(255,255,255,0.06);
    padding:8px 14px;
    border-radius:999px;
    color:#ffd5e9;
    font-weight:700;
    z-index:10040;
    pointer-events:none;
    backdrop-filter: blur(6px);
    border:1px solid rgba(255,255,255,0.04);
    display:none;
  }

  /* fake screenshot thumbnail */
  #screenshotThumb{position:fixed; right:18px; bottom:-160px; width:160px; height:90px; border-radius:8px; overflow:hidden; box-shadow:0 12px 30px rgba(0,0,0,0.6); background:linear-gradient(180deg,#fff0f8,#ffe6f2); z-index:10035; display:none; border:3px solid rgba(255,255,255,0.2);}

  /* loading overlay for video (lower z than video) */
  #loadingOverlay{display:none; position:fixed; inset:0; background:rgba(0,0,0,0.75); color:white; display:flex; flex-direction:column; align-items:center; justify-content:center; z-index:10015;}
  #loadingOverlay .bar {width:60%;height:10px;background:#222;border-radius:6px;overflow:hidden;}
  #loadingOverlay .bar > div{width:0%;height:100%;background:#ffb3d9;transition:width 0.2s;}

  /* small util */
  .muted{color:#9fb6c9;}
  .centered{display:flex;align-items:center;justify-content:center;}
</style>
</head>
<body>

<!-- CAPTIONS -->
<div id="floatingCaption" class="caption">Siap-siap! ğŸ</div>

<!-- GIFT SCREEN -->
<div id="giftScreen">
  <h2 style="margin-bottom:18px;color:#ffcce0">Ada hadiah buat kamu ğŸ</h2>
  <div id="giftBox" role="button" aria-label="Buka Kado">ğŸ</div>
  <p style="margin-top:14px;color:#a4b8cc">Klik dulu kadonya yaâ€¦</p>
</div>

<!-- CONFETTI CANVAS -->
<canvas id="confettiCanvas"></canvas>

<!-- COUNTDOWN (reused when necessary) -->
<div id="introWrap" class="introWrap">
  <div id="countNum">3</div>
  <div id="countText">(siap.. )</div>
</div>

<!-- MINI GAME -->
<div id="miniGameScreen">
  <h2 style="color:#ffcce0;margin-bottom:8px">Mini Game Dulu ğŸ˜</h2>
  <p class="muted">Klik 10 hati sebelum mereka kabur!</p>
  <div id="heartsArea"></div>
  <p id="heartCounter" style="margin-top:12px;color:#ffcce0;font-weight:700">0 / 10</p>
</div>

<!-- CINEMATIC LETTERBOX -->
<div id="barTop" class="letterbar"></div>
<div id="barBottom" class="letterbar"></div>

<!-- VIDEO -->
<div id="videoSection">
  <div class="videoContainer">
    <video id="introVideo" playsinline preload="auto">
      <source src="intro.mp4" type="video/mp4" />
    </video>
  </div>
</div>

<!-- FAKE SCREENSHOT OVERLAY & THUMB -->
<div id="shotOverlay" style="display:none;"><div id="shotText" style="color:white;font-size:20px;">Menyimpan momen... ğŸ“¸</div></div>
<div id="screenshotThumb"></div>

<!-- BOOK READER (auto flip) -->
<div id="bookReader">
  <div id="bookWrapper">
    <div id="bookOuter">
      <div id="bookPages">
        <div class="page" style="background:linear-gradient(180deg,#fff7fb,#fff0f8);">
          <div class="page-title">Happy Birthday Devit aka little_drax7 ğŸ‰</div>
          <div class="page-body">makasih udah jadi partner balapan roblox, partner naik gunung, dan partner nyebelin harian :))</div>
        </div>

        <div class="page" style="background:linear-gradient(180deg,#fffaf0,#fff4e8);">
          <div class="page-title">Kurang-kurangin tuh begadangnya. ğŸ¥¹</div>
          <div class="page-body">jaga kesehatan ya. jangan sampai sakit ultramen penjaga buminya</div>
        </div>

        <div class="page" style="background:linear-gradient(180deg,#f0fff6,#e8fff1);">
          <div class="page-title">Tetap jadi kamu</div>
          <div class="page-body">yang kadang ngeselin, nyebelin tapi ada sisi manisnya ğŸ’« (hueekk kok mual ya)</div>
        </div>

        <div class="page" style="background:linear-gradient(180deg,#fffef2,#fff6e8);">
          <div class="page-title">Doaku buat yg lagi hbd ğŸ¤</div>
          <div class="page-body">semoga semua langkahmu dipermudah tuhan, rezekimu dilancarkan, dan hatimu selalu tenang jangan marah2 terus</div>
        </div>

        <div class="page" style="background:linear-gradient(180deg,#fff1f6,#ffeef8);">
          <div class="page-title">love u ğŸ’•</div>
          <div class="page-body">selesai â€” cinta selalu</div>
        </div>
      </div>
      <div id="bookHearts"></div>
    </div>
  </div>
</div>

<!-- LOADING overlay (lower than video; used as backup) -->
<div id="loadingOverlay">
  <div id="loadingText" style="margin-bottom:14px;color:white">Loading sabar yang...</div>
  <div class="bar"><div id="progressBar" style="width:0%"></div></div>
</div>

<!-- AUDIO -->
<audio id="bgm" loop preload="auto"><source src="song.mp3" type="audio/mpeg"></audio>

<script>
// ====== Elements ======
const giftBox = document.getElementById('giftBox');
const giftScreen = document.getElementById('giftScreen');

const confettiCanvas = document.getElementById('confettiCanvas');
const ctx = confettiCanvas.getContext('2d');

const floatingCaption = document.getElementById('floatingCaption');
const introWrap = document.getElementById('introWrap');
const countNum = document.getElementById('countNum');

const miniGameScreen = document.getElementById('miniGameScreen');
const heartsArea = document.getElementById('heartsArea');
const heartCounter = document.getElementById('heartCounter');

const videoSection = document.getElementById('videoSection');
const introVideo = document.getElementById('introVideo');
const loadingOverlay = document.getElementById('loadingOverlay');
const progressBar = document.getElementById('progressBar');

const barTop = document.getElementById('barTop');
const barBottom = document.getElementById('barBottom');

const shotOverlay = document.getElementById('shotOverlay');
const screenshotThumb = document.getElementById('screenshotThumb');

const bgm = document.getElementById('bgm');

const bookReader = document.getElementById('bookReader');
const bookPages = Array.from(document.querySelectorAll('#bookPages .page'));
const bookHearts = document.getElementById('bookHearts');

// small web audio for sfx (pop / click)
const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function beep(freq=880, time=0.08, vol=0.02){
  try{
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type = 'sine';
    o.frequency.value = freq;
    g.gain.value = vol;
    o.connect(g); g.connect(audioCtx.destination);
    o.start();
    g.gain.setValueAtTime(vol, audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + time);
    o.stop(audioCtx.currentTime + time + 0.02);
  }catch(e){}
}

// small helper
function wait(ms){ return new Promise(res => setTimeout(res, ms)); }
function showCaption(text, duration=1500){
  const el = document.getElementById('floatingCaption');
  el.textContent = text;
  el.style.display = 'block';
  gsap.fromTo(el, {y:-18, opacity:0}, {y:0, opacity:1, duration:0.45, ease:'power2.out'});
  setTimeout(()=> gsap.to(el, {opacity:0, y:-10, duration:0.4, onComplete: ()=> el.style.display='none'}), duration);
}

// ====== CONFETTI (mixed shapes) ======
let confettis = [], runConfetti=false, confettiRAF=null;
function createConfettiParticle(){
  const w = confettiCanvas.width, h = confettiCanvas.height;
  return {
    x: Math.random()*w,
    y: Math.random()*-h - Math.random()*200,
    r: 4 + Math.random()*10,
    speed: 1 + Math.random()*2,
    sway: Math.random()*1.4,
    angle: Math.random()*Math.PI*2,
    shape: (Math.random()<0.6?'circle':(Math.random()<0.5?'star':'heart')),
    color: ['#ff99c8','#ffcce0','#ffb3d9','#ffe5ec','#fff0b3'][Math.floor(Math.random()*5)]
  };
}
function startConfetti(){
  confettiCanvas.width = innerWidth; confettiCanvas.height = innerHeight;
  confettis = []; runConfetti = true;
  for(let i=0;i<100;i++) confettis.push(createConfettiParticle());
  confettiCanvas.style.display='block';
  animateConfetti();
}
function drawStar(x,y,r){ ctx.save(); ctx.beginPath(); for(let i=0;i<5;i++){ ctx.lineTo(Math.cos((18+72*i)/180*Math.PI)*r + x, -Math.sin((18+72*i)/180*Math.PI)*r + y); ctx.lineTo(Math.cos((54+72*i)/180*Math.PI)*r/2 + x, -Math.sin((54+72*i)/180*Math.PI)*r/2 + y);} ctx.closePath(); ctx.fill(); ctx.restore();}
function drawHeart(x,y,r){ ctx.save(); ctx.beginPath(); const topCurveHeight = r * 0.3; ctx.moveTo(x, y + topCurveHeight); ctx.bezierCurveTo(x, y, x - r, y, x - r, y + topCurveHeight); ctx.bezierCurveTo(x - r, y + (r*0.75), x, y + (r*0.95), x, y + r); ctx.bezierCurveTo(x, y + (r*0.95), x + r, y + (r*0.75), x + r, y + topCurveHeight); ctx.bezierCurveTo(x + r, y, x, y, x, y + topCurveHeight); ctx.fill(); ctx.restore();}
function animateConfetti(){
  if(!runConfetti){ ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height); confettis=[]; confettiCanvas.style.display='none'; if(confettiRAF) cancelAnimationFrame(confettiRAF); confettiRAF=null; return; }
  ctx.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
  confettis.forEach(p=>{
    ctx.save();
    ctx.fillStyle = p.color;
    if(p.shape==='circle'){ ctx.beginPath(); ctx.arc(p.x,p.y,p.r,0,Math.PI*2); ctx.fill(); }
    else if(p.shape==='star'){ drawStar(p.x,p.y,p.r); }
    else { drawHeart(p.x,p.y,p.r*0.7); }
    ctx.restore();
    p.y += p.speed;
    p.x += Math.sin(p.angle) * p.sway;
    p.angle += 0.02;
    if(p.y > confettiCanvas.height + 30){ p.y = -10 - Math.random()*200; p.x = Math.random()*confettiCanvas.width; p.speed = 1 + Math.random()*2; }
  });
  confettiRAF = requestAnimationFrame(animateConfetti);
}
function stopConfettiNow(){ runConfetti=false; }

// ====== FLOW: gift -> confetti -> countdown -> mini-game ======
giftBox.addEventListener('click', async function onClick(){
  try{ bgm.volume = 0.9; bgm.play().catch(()=>{}); }catch(e){}
  showCaption('Wuhuu! Buka kadonya ğŸ', 1400);
  startConfetti();
  beep(880,0.06,0.02);
  gsap.fromTo(giftBox, {scale:1}, {scale:1.08, duration:0.12, yoyo:true, repeat:1});
  await wait(700);
  gsap.to(giftScreen, {opacity:0, duration:0.9});
  await wait(900);
  giftScreen.style.display='none';
  showCaption('Confetti polkadot! âœ¨', 900);
  await wait(700);
  // show 3s visual countdown (reuse introWrap)
  introWrap.style.display='block';
  await runCountdown(3); // 3s
  introWrap.style.display='none';
  await wait(300);
  startMiniGame();
}, { once:true });

function runCountdown(seconds=3){
  return new Promise(resolve=>{
    let remaining = seconds;
    countNum.textContent = remaining;
    introWrap.style.display='block';
    const tick = setInterval(()=>{
      gsap.fromTo(countNum, {scale:1.2, opacity:0.4}, {scale:1, opacity:1, duration:0.45, ease:'power2.out'});
      countNum.textContent = remaining;
      remaining--;
      if(remaining < 0){
        clearInterval(tick);
        resolve();
      }
    }, 950);
  });
}

// ====== MINI GAME (click 10 hearts) ======
let miniGameActive=false, hit=0;
function startMiniGame(){
  miniGameActive = true; hit = 0; heartCounter.textContent = `${hit} / 10`; heartsArea.innerHTML = ''; miniGameScreen.style.display='flex';
  showCaption('Klik 10 hati! â¤ï¸', 1400);
  for(let i=0;i<10;i++) setTimeout(()=> createMovingHeart(), i*200);
}
function createMovingHeart(){
  const h = document.createElement('div');
  h.innerHTML = 'â¤ï¸';
  h.style.position='absolute';
  h.style.left = (10 + Math.random()*80) + '%';
  h.style.top = (10 + Math.random()*70) + '%';
  h.style.fontSize = (22 + Math.random()*22) + 'px';
  h.style.cursor='pointer';
  h.style.userSelect='none';
  h.style.touchAction='manipulation';

  h.addEventListener('click', ()=>{
    if(!miniGameActive) return;
    hit++; heartCounter.textContent = `${hit} / 10`;
    beep(1000 - hit*20,0.06,0.02);
    gsap.to(h, {scale:1.4, opacity:0, duration:0.22, onComplete: ()=> h.remove()});
    if(hit >= 10){
      miniGameActive = false;
      gsap.to(miniGameScreen, {opacity:0, duration:0.6, onComplete: ()=> { miniGameScreen.style.display='none'; (async()=>{ await autoScreenshotMoment(); await cinematicOpenThenPlayVideo(); })(); }});
    }
  }, { once:true });

  heartsArea.appendChild(h);
  gsap.to(h, { x: (Math.random()*160)-80, y: (Math.random()*120)-60, duration: 2 + Math.random()*2, ease: 'sine.inOut', repeat: -1, yoyo: true });
  gsap.fromTo(h, {opacity:0, scale:0.7}, {opacity:1, scale:1, duration:0.45});
}

// ====== Fake auto-screenshot moment ======
async function autoScreenshotMoment(){
  shotOverlay.style.display='flex';
  document.getElementById('shotText').textContent = 'Menyimpan momen manis... ğŸ“¸';
  showCaption('Ngambil screenshot...!', 1000);
  beep(780,0.12,0.02);
  await wait(900);

  // thumbnail animation
  screenshotThumb.innerHTML = '<div style="width:100%;height:100%;display:flex;align-items:center;justify-content:center;font-weight:700;color:#7a1237;">Saved</div>';
  screenshotThumb.style.display = 'block';
  gsap.to(screenshotThumb, {bottom: "18px", duration:0.56, ease:'power3.out'});

  // little flash
  const flash = document.createElement('div'); flash.style.position='fixed'; flash.style.inset='0'; flash.style.background='white'; flash.style.opacity='0'; flash.style.zIndex=10050; document.body.appendChild(flash);
  gsap.to(flash, {opacity:0.85, duration:0.06, onComplete: ()=> gsap.to(flash,{opacity:0, duration:0.26, onComplete: ()=> flash.remove()})});
  await wait(420);

  shotOverlay.style.display='none';
  showCaption('Tersimpan! ğŸ‰', 1200);
  beep(1100,0.09,0.02);

  // auto-hide thumbnail after delay
  setTimeout(()=> {
    gsap.to(screenshotThumb, {bottom: "-160px", duration:0.6, ease:'power3.in', onComplete: ()=> screenshotThumb.style.display='none'});
  }, 2000);
}

// ====== Cinematic bars + 3s countdown then play video ======
async function cinematicOpenThenPlayVideo(){
  // show bars
  gsap.set([barTop, barBottom], {height:0, display:'block'});
  gsap.to([barTop, barBottom], {height:'14vh', duration:0.6, ease:'power3.out'});
  await wait(700);

  // stop confetti & tone down music
  stopConfettiNow();
  gsap.to(bgm, {volume:0.35, duration:0.9});

  // show small 3-second visual countdown on center
  await runCountdown(3);

  // show video section
  videoSection.style.display='flex';
  gsap.fromTo(videoSection, {opacity:0}, {opacity:1, duration:0.45});
  // prepare video
  loadingOverlay.style.display = 'flex'; // show backup loading overlay below video
  try{
    introVideo.load();
    await new Promise(res=>{
      let done=false;
      introVideo.addEventListener('canplaythrough', ()=>{ if(!done){ done=true; res(); } }, { once:true });
      setTimeout(()=> { if(!done){ done=true; res(); } }, 3500);
    });
  }catch(e){}
  loadingOverlay.style.display='none';
  gsap.to([barTop, barBottom], {height:'10vh', duration:0.35});

  // play video (catch autoplay block)
  try{ await introVideo.play(); }catch(e){ try{ await introVideo.play(); }catch(e){} }

  // when video ends -> hide video & open book
  introVideo.addEventListener('ended', async ()=>{
    gsap.to(videoSection, {opacity:0, duration:0.7, onComplete: ()=> videoSection.style.display='none'});
    // animate bars out
    gsap.to([barTop, barBottom], {height:'0vh', duration:0.8, ease:'power3.inOut'});
    // stop bgm
    gsap.to(bgm, {volume:0, duration:1.1, onComplete: ()=> { try{ bgm.pause(); bgm.currentTime=0;}catch(e){} }});
    await wait(500);
    startBookFlip();
  }, { once:true });
}

// ====== BOOK FLIP (auto, sequential, no overlap) ======
async function startBookFlip(){
  bookReader.style.display = 'flex';

  // ensure initial state
  gsap.set('#bookOuter', {rotateZ:-6});
  bookPages.forEach((p,i)=> {
    gsap.set(p, {rotateY:90, transformOrigin:'left center'});
    p.style.zIndex = bookPages.length - i;
  });

  // sequential flip
  for(let i=0;i<bookPages.length;i++){
    showCaption(`Membuka halaman ${i+1} ...`, 900);
    await new Promise(res => gsap.to(bookPages[i], {rotateY:0, duration:1.05, ease:'power3.out', onComplete: res}));
    // wait for a readable time
    await wait(2200);
  }

  // after flipping, spawn floating hearts
  spawnBookHearts();
  showCaption('Selesai â€” HBD lagi! ğŸ‰', 2000);
}

function spawnBookHearts(){
  setInterval(()=> {
    const h = document.createElement('div'); h.innerHTML = 'ğŸ’—';
    h.style.position='absolute';
    h.style.left = (8 + Math.random()*84) + '%';
    h.style.bottom = '-8px';
    h.style.fontSize = (12 + Math.random()*26) + 'px';
    bookHearts.appendChild(h);
    gsap.to(h, {y: - (200 + Math.random()*260), opacity:0, duration:2.6 + Math.random()*1.4, ease:'power1.out', onComplete: ()=> h.remove()});
  }, 300);
}

// ====== resize / safety handlers ======
window.addEventListener('resize', ()=>{
  confettiCanvas.width = innerWidth;
  confettiCanvas.height = innerHeight;
});
window.addEventListener('pagehide', ()=> stopConfettiNow());

// ====== init minimal: set canvas sizes ======
confettiCanvas.width = innerWidth;
confettiCanvas.height = innerHeight;

</script>
</body>
</html>
